# 物品栏系统实现方案

## 1. 架构设计

### 1.1 文件夹结构
```
js/
├── ui/
│   ├── UIManager.js          # UI管理器，负责UI元素的生命周期管理
│   ├── UIPanel.js            # UI面板基类
│   ├── Inventory.js          # 物品栏主面板
│   ├── InventorySlot.js      # 物品栏格子
│   ├── UIButton.js           # UI按钮组件
│   └── items/
│       ├── Item.js           # UI物品基类
│       ├── ItemConfig.js     # 物品配置表
│       └── ItemFactory.js    # 物品工厂，用于创建不同类型的物品
└── core/
    └── Game.js               # 修改Game.js，集成UI系统
```

### 1.2 核心组件设计

#### UIManager
- 负责管理所有UI元素的创建、更新、渲染和销毁
- 提供UI元素的注册和获取方法
- 处理UI事件分发
- 管理鼠标悬停状态

#### Inventory
- 物品栏主面板，包含10个物品格子
- 监听键盘I键和关闭按钮事件
- 管理物品栏的显示/隐藏状态
- 处理鼠标位置检测

#### InventorySlot
- 单个物品格子，可显示物品图标和数量
- 处理鼠标交互事件（悬停、按下、释放）
- 支持三种状态样式：正常、悬停、按下
- 鼠标悬停时增加亮度，按下时亮度变化，移走时恢复

#### Item 系统
- **ItemConfig.js**：定义所有物品的配置信息，包括ID、名称、类型、效果等
- **ItemFactory.js**：根据配置创建不同类型的物品实例
- **Item.js**：UI物品基类，包含使用方法和渲染逻辑

## 2. 实现步骤

### 2.1 创建UI基础组件
1. 创建 `UIManager.js` - UI管理器，添加鼠标状态管理
2. 创建 `UIPanel.js` - 面板基类，添加状态样式支持
3. 创建 `UIButton.js` - 按钮组件，添加交互效果

### 2.2 实现物品系统
1. 创建 `ItemConfig.js` - 物品配置表
2. 创建 `Item.js` - 物品基类
3. 创建 `ItemFactory.js` - 物品工厂

### 2.3 实现物品栏组件
1. 创建 `InventorySlot.js` - 物品格子，添加交互效果
2. 创建 `Inventory.js` - 物品栏面板

### 2.4 集成到游戏中
1. 修改 `Game.js`，添加UI管理器
2. 在游戏循环中更新和渲染UI
3. 添加键盘I键监听，控制物品栏显示/隐藏

### 2.5 物品使用效果
1. 实现不同类型物品的使用逻辑
2. 设计可扩展的物品效果系统
3. 支持物品效果的配置化

## 3. 技术实现要点

### 3.1 交互效果实现
- **状态管理**：每个UI元素维护三种状态：normal、hover、active
- **亮度变化**：通过调整颜色亮度实现交互反馈
- **鼠标检测**：在UIManager中实现鼠标位置检测，更新元素状态
- **渲染优先级**：悬停元素优先渲染

### 3.2 颜色亮度调整算法
```javascript
// 调整颜色亮度的辅助函数
function adjustBrightness(color, amount) {
    // 解析颜色值
    // 调整RGB分量
    // 返回新颜色
}
```

### 3.3 事件处理
- 使用现有的Input系统处理键盘和鼠标事件
- 实现UI元素的碰撞检测，处理鼠标悬停和点击事件
- 支持事件冒泡机制

### 3.4 物品配置示例
```javascript
// ItemConfig.js 示例配置
const ItemConfigs = {
    1: {
        id: 1,
        name: "生命药水",
        type: "consumable",
        effect: { type: "heal", value: 50 },
        icon: "#FF0000" // 临时使用颜色作为图标
    },
    2: {
        id: 2,
        name: "力量药水",
        type: "consumable",
        effect: { type: "buff", attribute: "strength", value: 10, duration: 10 }
    }
};
```

### 3.5 物品使用流程
1. 玩家点击物品栏中的物品
2. InventorySlot触发点击事件
3. Inventory处理点击事件，调用物品的use方法
4. Item根据配置执行相应的效果
5. 更新玩家状态或游戏世界

## 4. 文件修改清单

### 新增文件
- `js/ui/UIManager.js`
- `js/ui/UIPanel.js`
- `js/ui/UIButton.js`
- `js/ui/Inventory.js`
- `js/ui/InventorySlot.js`
- `js/ui/items/Item.js`
- `js/ui/items/ItemConfig.js`
- `js/ui/items/ItemFactory.js`

### 修改文件
- `js/core/Game.js` - 集成UI系统
- `js/core/Renderer.js` - 添加UI渲染支持

## 5. 交互效果细节

### 5.1 物品格子交互
- **正常状态**：默认亮度
- **悬停状态**：亮度增加20%
- **按下状态**：亮度降低10%
- **渲染顺序**：按下状态 > 悬停状态 > 正常状态

### 5.2 按钮交互
- **正常状态**：默认样式
- **悬停状态**：背景色亮度增加15%
- **按下状态**：背景色亮度降低15%

### 5.3 物品栏面板
- 半透明背景
- 边框高亮效果
- 关闭按钮悬停效果

## 6. 扩展性设计

### 6.1 物品类型扩展
- 通过ItemConfig.js可以轻松添加新的物品类型
- ItemFactory支持动态创建不同类型的物品
- 物品效果系统支持多种效果类型

### 6.2 UI组件扩展
- 基于UIPanel和UIButton基类，可以扩展更多UI组件
- UIManager支持管理任意类型的UI元素
- 支持多层UI面板和模态窗口

### 6.3 交互方式扩展
- 预留拖拽功能接口
- 支持键盘快捷键操作
- 支持物品组合和合成

## 7. 实现效果

- 按键盘I键可以显示/隐藏物品栏
- 物品栏包含10个物品格子
- 每个格子可以显示物品图标和数量
- 鼠标悬停时格子亮度增加，移走时恢复
- 鼠标按下时格子亮度变化，提供视觉反馈
- 点击物品可以使用，触发相应效果
- 物品栏右上角有关闭按钮，支持交互效果
- 支持多种物品类型和效果

这个实现方案遵循了类Unity的组件化设计，将UI系统作为独立模块，便于维护和扩展。物品系统采用配置化设计，支持后续添加更多物品类型和效果。交互效果通过状态管理和颜色亮度调整实现，提供良好的视觉反馈。